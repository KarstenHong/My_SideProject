<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ´ªå¸«å‚…2026é‡‘é¦¬å¹´èœ - è¨‚å–®ç®¡ç†ç³»çµ±</title>
    <link rel="stylesheet" href="ChineseNewYear_Dishes.css" />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- åŒ¯å‡ºåŠŸèƒ½æ‰€éœ€çš„åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      /* ç®¡ç†é é¢å°ˆç”¨æ¨£å¼ */
      .nav-bar {
        background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
        padding: 12px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .nav-bar a {
        color: white;
        text-decoration: none;
        padding: 10px 25px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        transition: all 0.3s ease;
        font-weight: bold;
      }

      .nav-bar a:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .nav-bar .current-page {
        color: white;
        font-weight: bold;
        font-size: 1.1em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ§§ æ´ªå¸«å‚…2026é‡‘é¦¬å¹´èœ ğŸ§§</h1>
        <p>è¨‚å–®ç®¡ç†èˆ‡çµ±è¨ˆç³»çµ±</p>
      </header>

      <div class="nav-bar">
        <div class="current-page">ğŸ“Š è¨‚å–®ç®¡ç†</div>
        <a href="order.html">ğŸ“ å¿«é€Ÿé»é¤</a>
      </div>

      <!-- çµ±è¨ˆé¢æ¿ (åƒ…ç®¡ç†å“¡å¯è¦‹) -->
      <div class="statistics-panel admin-only" style="display: none">
        <div class="stat-card">
          <h3>ç¸½è¨‚å–®æ•¸</h3>
          <p class="stat-value" id="totalOrders">0</p>
        </div>
        <div class="stat-card">
          <h3>ç¸½é‡‘é¡</h3>
          <p class="stat-value" id="totalRevenue">NT$ 0</p>
        </div>
        <div class="stat-card">
          <h3>ç†±é–€èœå“</h3>
          <p class="stat-value" id="popularDish">-</p>
        </div>
      </div>

      <!-- èœå“ç®¡ç†å€ (åƒ…ç®¡ç†å“¡å¯è¦‹) -->
      <div
        class="form-section dish-management-section admin-only"
        style="display: none"
      >
        <h2>ğŸ½ï¸ èœå“ç®¡ç†</h2>
        <div class="dish-management-controls">
          <button
            type="button"
            class="btn-primary"
            onclick="showAddDishModal()"
          >
            â• æ–°å¢èœå“
          </button>
          <button
            type="button"
            class="btn-secondary"
            onclick="toggleDishList()"
          >
            ğŸ“‹ ç®¡ç†ç¾æœ‰èœå“
          </button>
        </div>
        <div
          id="dishListContainer"
          class="dish-list-container"
          style="display: none"
        >
          <div class="dishes-table">
            <div class="dishes-header">
              <div>èœå“åç¨±</div>
              <div>å–®åƒ¹</div>
              <div>æ“ä½œ</div>
            </div>
            <div id="manageDishList"></div>
          </div>
        </div>
      </div>

      <!-- è¨‚å–®åˆ—è¡¨ -->
      <div class="orders-section">
        <div class="section-header">
          <h2>è¨‚å–®ç®¡ç†</h2>
          <div class="export-buttons">
            <input
              type="file"
              id="importFileInput"
              accept=".xlsx,.xls"
              style="display: none"
              onchange="importFromExcel(event)"
            />
            <button
              class="btn-import"
              onclick="document.getElementById('importFileInput').click()"
            >
              ğŸ“¥ åŒ¯å…¥ Excel
            </button>
            <button class="btn-export" onclick="exportToExcel()">
              ğŸ“Š åŒ¯å‡º Excel
            </button>
            <button class="btn-export" onclick="exportToPDF()">
              ğŸ“„ åŒ¯å‡º PDF
            </button>
          </div>
        </div>
        <div class="search-bar">
          <input
            type="text"
            id="searchInput"
            placeholder="æœå°‹å®¢æˆ¶å§“åã€é›»è©±ã€ç¾¤çµ„æˆ–è¨‚å–®è™Ÿç¢¼..."
          />
          <select id="groupFilter">
            <option value="">æ‰€æœ‰ç¾¤çµ„</option>
          </select>
          <button onclick="searchOrders()">æœå°‹</button>
          <button onclick="clearSearch()">æ¸…é™¤</button>
        </div>

        <!-- è¨‚å–®è¡¨æ ¼ -->
        <div class="orders-table-container">
          <table class="orders-table">
            <thead>
              <tr>
                <th>è¨‚å–®è™Ÿç¢¼</th>
                <th>è¨‚è³¼äºº</th>
                <th>è¯çµ¡é›»è©±</th>
                <th>æ‰€å±¬ç¾¤çµ„</th>
                <th>è¨‚è³¼æ—¥æœŸ</th>
                <th>ç¸½é‡‘é¡</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="ordersTableBody">
              <!-- ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </tbody>
          </table>
        </div>

        <!-- åˆ†é æ§åˆ¶ -->
        <div class="pagination-container">
          <div class="pagination-info" id="pageInfo">
            é¡¯ç¤ºç¬¬ 0-0 ç­†ï¼Œå…± 0 ç­†è¨‚å–®
          </div>
          <div class="pagination-controls">
            <button
              class="pagination-btn"
              onclick="changePage('first')"
              id="firstPageBtn"
            >
              é¦–é 
            </button>
            <button
              class="pagination-btn"
              onclick="changePage('prev')"
              id="prevPageBtn"
            >
              ä¸Šä¸€é 
            </button>
            <span class="pagination-current" id="currentPage">ç¬¬ 1 / 1 é </span>
            <button
              class="pagination-btn"
              onclick="changePage('next')"
              id="nextPageBtn"
            >
              ä¸‹ä¸€é 
            </button>
            <button
              class="pagination-btn"
              onclick="changePage('last')"
              id="lastPageBtn"
            >
              æœ«é 
            </button>
          </div>
          <div class="page-size-selector">
            æ¯é é¡¯ç¤º
            <select id="pageSizeSelect" onchange="changePageSize()">
              <option value="10">10</option>
              <option value="20" selected>20</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
            ç­†
          </div>
        </div>
      </div>
    </div>

    <!-- è¨‚å–®è©³æƒ…Modal -->
    <div id="orderDetailModal" class="modal">
      <div class="modal-content modal-large">
        <span class="close" onclick="closeOrderDetailModal()">&times;</span>
        <h2>è¨‚å–®è©³æƒ…</h2>
        <div id="orderDetailContainer"></div>
      </div>
    </div>

    <!-- ç·¨è¼¯è¨‚å–®Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h2>ç·¨è¼¯è¨‚å–®</h2>
        <div id="editFormContainer"></div>
      </div>
    </div>

    <!-- æ–°å¢èœå“Modal -->
    <div id="addDishModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeAddDishModal()">&times;</span>
        <h2>æ–°å¢èœå“</h2>
        <form id="addDishForm" onsubmit="handleAddDish(event)">
          <div class="form-field">
            <label for="newDishName">èœå“åç¨± *</label>
            <input
              type="text"
              id="newDishName"
              placeholder="è«‹è¼¸å…¥èœå“åç¨±"
              required
            />
          </div>
          <div class="form-field">
            <label for="newDishPrice">å–®åƒ¹ (NT$) *</label>
            <input
              type="number"
              id="newDishPrice"
              placeholder="è«‹è¼¸å…¥å–®åƒ¹"
              min="1"
              required
            />
          </div>
          <div class="form-actions">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeAddDishModal()"
            >
              å–æ¶ˆ
            </button>
            <button type="submit" class="btn-primary">æ–°å¢</button>
          </div>
        </form>
      </div>
    </div>

    <!-- é‡è¤‡è¨‚å–®è™•ç†Modal -->
    <div id="duplicateOrderModal" class="modal">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2>âš ï¸ ç™¼ç¾é‡è¤‡è¨‚å–®</h2>
          <span class="duplicate-info" id="duplicateInfo"></span>
        </div>
        <div class="duplicate-comparison">
          <div class="comparison-column">
            <h3>ğŸ“‹ ç¾æœ‰è¨‚å–®</h3>
            <div id="existingOrderDetail" class="order-detail-box"></div>
          </div>
          <div class="comparison-divider">
            <div class="arrow">â†’</div>
          </div>
          <div class="comparison-column">
            <h3>ğŸ“¥ åŒ¯å…¥è¨‚å–®</h3>
            <div id="importOrderDetail" class="order-detail-box"></div>
          </div>
        </div>
        <div class="modal-actions">
          <button
            type="button"
            class="btn-secondary"
            onclick="handleDuplicateOrder('skip')"
          >
            âŒ è·³éæ­¤ç­†
          </button>
          <button
            type="button"
            class="btn-warning"
            onclick="handleDuplicateOrder('update')"
          >
            ğŸ”„ æ›´æ–°è¦†è“‹
          </button>
          <button
            type="button"
            class="btn-primary"
            onclick="showCustomOrderNumberInput()"
          >
            â• å¼·åˆ¶åŠ å…¥ï¼ˆè‡ªè¨‚åºè™Ÿï¼‰
          </button>
        </div>
        <div
          id="customOrderNumberSection"
          class="custom-order-number-section"
          style="display: none"
        >
          <div class="input-group">
            <label for="customOrderNumber">è«‹è¼¸å…¥æ–°çš„è¨‚å–®è™Ÿç¢¼ï¼š</label>
            <input
              type="text"
              id="customOrderNumber"
              placeholder="ä¾‹å¦‚ï¼š001-A æˆ– #001_å‰¯æœ¬"
              class="custom-order-input"
            />
          </div>
          <div class="input-actions">
            <button
              type="button"
              class="btn-secondary-sm"
              onclick="hideCustomOrderNumberInput()"
            >
              å–æ¶ˆ
            </button>
            <button
              type="button"
              class="btn-success-sm"
              onclick="confirmCustomOrderNumber()"
            >
              ç¢ºèªåŠ å…¥
            </button>
          </div>
        </div>
        <div class="modal-footer">
          <span id="duplicateProgress"></span>
        </div>
      </div>
    </div>

    <!-- è‡ªè¨‚æç¤ºçª— -->
    <div id="customAlert" class="custom-alert-overlay">
      <div class="custom-alert-box">
        <div class="custom-alert-icon" id="alertIcon"></div>
        <div class="custom-alert-message" id="alertMessage"></div>
        <div class="custom-alert-buttons" id="alertButtons"></div>
      </div>
    </div>

    <!-- Firebase é…ç½® -->
    <script src="firebase-config.js"></script>

    <script src="ChineseNewYear_Dishes.js"></script>
  </body>
</html>
